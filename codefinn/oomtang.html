<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <title>บันทึกรายรับรายจ่าย by iton5</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.3.5/dist/alpine.min.js"></script>

  <link rel="stylesheet" href="https://bit.ly/fontiton5" type="text/css" charset="utf-8" />
  <style type="text/css">
    :root {
      --box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12),
        0 1px 2px rgba(0, 0, 0, 0.24);
    }

    * {
      box-sizing: border-box;
    }

    body {
      background-color: #f7f7f7;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      font-family: 'line_seed_sans_th';

    }

    .container {
      margin: 30px auto;
      height: 100vh;
      width: 80vw;
    }

    h1 {
      letter-spacing: 1px;
      margin: 0;
    }

    h3 {
      border-bottom: 1px solid #bbb;
      padding-bottom: 10px;
      margin: 40px 0 10px;
    }

    h4 {
      margin: 0;
      text-transform: uppercase;
    }

    .inc-exp-container {
      background-color: #fff;
      box-shadow: var(--box--shadow);
      padding: 20px;
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }

    .inc-exp-container>div {
      flex: 1;
      text-align: center;
    }

    .inc-exp-container>div:first-of-type {
      border-right: 1px solid #dedede;
    }

    .money {
      font-size: 2;
      letter-spacing: 1px;
      margin: 5px 0;
    }

    .money-plus {
      color: #0b9b47;
    }

    .money-minus {
      color: #c0392b;
    }

    label {
      display: inline-block;
      margin: 10px 0;
    }

    input[type="text"],
    input[type="number"] {
      border: 1px solid #dedede;
      border-radius: 2px;
      display: block;
      font-size: 16px;
      padding: 10px;
      width: 100%;
    }

    .btn {
      cursor: pointer;
      background-color: #9c88ff;
      box-shadow: var(--box-shadow);
      color: #fff;
      border: 0;
      display: block;
      font-size: 16px;
      margin: 10px 0 30px;
      padding: 10px;
      width: 100%;
    }

    .btn:focus,
    .delete-btn:focus {
      outline: 0;
    }

    .list {
      list-style-type: none;
      padding: 0;
      margin-bottom: 40px;
    }

    .list li {
      background-color: #fff;
      box-shadow: var(--box--shadow);
      color: #333;
      display: flex;
      justify-content: space-between;
      position: relative;
      padding: 10px;
      margin: 10px 0;
    }

    .list li.plus {
      border-right: 5px solid #2ecc71;
    }

    .list li.minus {
      border-right: 5px solid #c0392b;
    }

    .delete-btn {
      /* background-color: #e74c3c; */
      border: 0;
      color: #e74c3c;
      font-size: 20px;
      line-height: 20px;
      padding: 2px 5px;
      position: absolute;
      top: 50%;
      left: 0;
      transform: translate(-100%, -50%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .list .delete-btn {
      opacity: 1;
    }
  </style>


</head>

<body>

  <nav class="bg-white dark:bg-gray-900 w-full z-20 top-0 left-0 border-b border-gray-200 dark:border-gray-600">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="#" class="flex items-center">

        <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"> Gramline</span>
      </a>

      <div class="flex items-center md:order-2">
        <button type="button"
          class="flex mr-3 text-sm bg-gray-800 rounded-full md:mr-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
          id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown"
          data-dropdown-placement="bottom">
          <span class="sr-only">Open user menu</span>
          <img class="w-8 h-8 rounded-full" src="https://sv1.picz.in.th/images/2023/03/17/eHZLft.png" alt="user photo"
            id="profileurl">
        </button>
        <div
          class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600"
          id="user-dropdown">
          <div class="px-4 py-3">
            <span class="block text-sm text-gray-900 dark:text-white" id="displaynamefield">Bonnie Green</span>
            <span class="block text-sm  text-gray-500 truncate dark:text-gray-400">Profile LINE</span>
          </div>
        </div>
      </div>
  </nav><br />

  <h1 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white md:text-5xl lg:text-6xl"><span
      class="text-transparent bg-clip-text bg-gradient-to-r to-emerald-600 from-sky-400">รายรับ</span> รายจ่าย <span
      class="bg-blue-100 text-blue-800 text-2xl font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800 ml-2">PRO</span>
  </h1>
  <h2 class="text-lg font-normal text-gray-500 lg:text-xl dark:text-gray-400">ระบบบันทึกรายรับรายจ่ายส่วนบุคคล</h2>
  <div class="container">
    <h4>ยอดคงเหลือ</h4>
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto ">
      <h1 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white md:text-5xl lg:text-6xl" id="balance">0.00
      </h1>

      <button type="button"
        class="text-blue-700 border border-blue-700 hover:bg-blue-700 hover:text-white focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm p-2.5 text-center inline-flex items-center dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:focus:ring-blue-800 dark:hover:bg-blue-500"
        id="sflex">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="w-3 h-3">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z" />
        </svg>


      </button>
    </div>
    <div class="inc-exp-container">
      <div>
        <h4>รายรับ</h4>
        <p id="money-plus" class="money-plus">
          +0.00
        </p>
      </div>
      <div>
        <h4>รายจ่าย</h4>
        <p id="money-minus" class="money-minus">
          -0.00
        </p>
      </div>
    </div>

    <h3>ประวัติทำรายการ</h3>
    <ul id="list" class="list">
      <li class="minus">
        Cash <span>-400</span>

        <button class="delete-btn">x</button>
      </li>
    </ul>

  </div>

  <!-- drawer init and toggle -->
  <div class="text-center" hidden>
    <button
      class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"
      type="button" data-drawer-target="drawer-swipe" data-drawer-show="drawer-swipe" data-drawer-placement="bottom"
      data-drawer-edge="true" data-drawer-edge-offset="bottom-[60px]" aria-controls="drawer-swipe">
      Show swipeable drawer
    </button>
  </div>

  <!-- drawer component -->
  <div id="drawer-swipe"
    class="fixed z-40 w-full overflow-y-auto bg-white border-t border-gray-200 rounded-t-lg dark:border-gray-700 dark:bg-gray-800 transition-transform bottom-0 left-0 right-0 translate-y-full bottom-[60px]"
    tabindex="-1" aria-labelledby="drawer-swipe-label">
    <div class="p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700" data-drawer-toggle="drawer-swipe">
      <span class="absolute w-8 h-1 -translate-x-1/2 bg-gray-300 rounded-lg top-3 left-1/2 dark:bg-gray-600"></span>
      <h5 id="drawer-swipe-label"
        class="inline-flex items-center text-base text-gray-500 dark:text-gray-400 font-medium"><svg
          class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
          viewBox="0 0 18 18">
          <path
            d="M6.143 0H1.857A1.857 1.857 0 0 0 0 1.857v4.286C0 7.169.831 8 1.857 8h4.286A1.857 1.857 0 0 0 8 6.143V1.857A1.857 1.857 0 0 0 6.143 0Zm10 0h-4.286A1.857 1.857 0 0 0 10 1.857v4.286C10 7.169 10.831 8 11.857 8h4.286A1.857 1.857 0 0 0 18 6.143V1.857A1.857 1.857 0 0 0 16.143 0Zm-10 10H1.857A1.857 1.857 0 0 0 0 11.857v4.286C0 17.169.831 18 1.857 18h4.286A1.857 1.857 0 0 0 8 16.143v-4.286A1.857 1.857 0 0 0 6.143 10ZM17 13h-2v-2a1 1 0 0 0-2 0v2h-2a1 1 0 0 0 0 2h2v2a1 1 0 0 0 2 0v-2h2a1 1 0 0 0 0-2Z" />
        </svg>บันทึกรายการ</h5>
    </div>
    <center>
      <div
        class="block max-w-auto p-6 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700 text-center ">
        <h1
          class="mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl dark:text-white">
          เพิ่มรายการใหม่</h1>
        <p class="text-lg font-normal text-gray-500 lg:text-xl dark:text-gray-400">(ถ้ามีรายรับ กรอกตัวเลขได้เลย
          หากมีรายจ่ายให้ใส่เครื่องหมาย - หน้าตัวเลข )</p>


        <form id="form">
          <div class="form-control">
            <label for="text">เขียนรายการ</label>
            <input type="text" id="text" placeholder="พิมพ์รายการ...." />
          </div>
          <div class="form-control">
            <label for="amount">จำนวนเงิน </label>
            <input type="number" id="amount" placeholder="พิมพ์จำนวนเงิน...">
          </div>
          <button class="btn" id="flex">เพิ่มรายการ</button>
        </form>

      </div>
    </center>
  </div>


  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>


  <script>

    window.onload = function () {

      $.getScript("https://yyyyyyy/zzzzzz.js", function () {

        initializeLiff("xxxxxxxxx");


      });
    }
    const sflex = document.getElementById(
      "sflex"
    );
    const balance = document.getElementById(
      "balance"
    );
    const money_plus = document.getElementById(
      "money-plus"
    );
    const money_minus = document.getElementById(
      "money-minus"
    );
    const list = document.getElementById("list");
    const form = document.getElementById("form");
    const text = document.getElementById("text");
    const amount = document.getElementById("amount");

    const localStorageTransactions = JSON.parse(localStorage.getItem('transactions'));

    let transactions = localStorage.getItem('transactions') !== null ? localStorageTransactions : [];

    function addTransaction(e) {
      e.preventDefault();
      if (text.value.trim() === '' || amount.value.trim() === '') {
        Swal.fire(
          'มีข้อผิดพลาด',
          'ยังไม่ได้กรอกข้อมูล?',
          'question'
        )
      } else {
        const transaction = {
          id: generateID(),
          text: text.value,
          amount: +amount.value
        }

        transactions.push(transaction);

        addTransactionDOM(transaction);
        updateValues();
        updateLocalStorage();
        Swal.fire(
          'สำเร็จ',
          'ทำการบันทึกเรียบร้อย',
          'success'
        )
        text.value = '';
        amount.value = '';
      }
    }


    function generateID() {
      return Math.floor(Math.random() * 1000000000);
    }


    function addTransactionDOM(transaction) {

      const sign = transaction.amount < 0 ? "-" : "+";
      const item = document.createElement("li");


      item.classList.add(
        transaction.amount < 0 ? "minus" : "plus"
      );

      item.innerHTML = `
    ${transaction.text} <span>${sign}${Math.abs(
        transaction.amount
      )}</span>
 
    <button type="button" class="delete-btn text-red-700 border border-red-700 hover:bg-red-700 hover:text-white focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-full text-sm p-2.5 text-center inline-flex items-center dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:focus:ring-red-800 dark:hover:bg-red-500" onclick="removeTransaction(${transaction.id})">
     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
</svg>
    </button>
    `;
      list.appendChild(item);
    }

    function updateValues() {
      const amounts = transactions.map(
        (transaction) => transaction.amount
      );
      const total = amounts
        .reduce((acc, item) => (acc += item), 0)
        .toFixed(2);
      const income = amounts
        .filter((item) => item > 0)
        .reduce((acc, item) => (acc += item), 0)
        .toFixed(2);
      const expense =
        (amounts
          .filter((item) => item < 0)
          .reduce((acc, item) => (acc += item), 0) *
          -1).toFixed(2);

      balance.innerText = `${parseFloat(total).toLocaleString('th-TH', {
        style: 'currency',
        currency: 'THB'
      })}`;
      money_plus.innerText = `${parseFloat(income).toLocaleString('th-TH', {
        style: 'currency',
        currency: 'THB'
      })}`;
      money_minus.innerText = `${parseFloat(expense).toLocaleString('th-TH', {
        style: 'currency',
        currency: 'THB'
      })}`;

      sflex.onclick = () => {
        var msg = [{
          "type": "flex",
          "altText": "ยอดคงเหลือ: " + balance.textContent,
          "contents": {
            "type": "bubble",
            "body": {
              "type": "box",
              "layout": "vertical",
              "contents": [
                {
                  "type": "box",
                  "layout": "horizontal",
                  "contents": [
                    {
                      "type": "text",
                      "text": "Saving",
                      "weight": "bold",
                      "color": "#1DB446",
                      "size": "sm"
                    },
                    {
                      "type": "box",
                      "layout": "vertical",
                      "contents": [
                        {
                          "type": "image",
                          "url": "" + liff.getDecodedIDToken().picture,
                          "size": "full"
                        }
                      ],
                      "width": "35px",
                      "height": "35px",
                      "borderWidth": "2px",
                      "borderColor": "#1DB446",
                      "cornerRadius": "150px"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "" + balance.textContent,
                  "weight": "bold",
                  "size": "xxl",
                  "margin": "md"
                },
                {
                  "type": "text",
                  "text": "บันทึกรายรับรายจ่ายของคุณ " + liff.getDecodedIDToken().name,
                  "size": "xs",
                  "color": "#aaaaaa",
                  "wrap": true
                },
                {
                  "type": "button",
                  "action": {
                    "type": "uri",
                    "label": "คลิกเพื่อออม",
                    "uri": "line://app/1654250114-bV8pOapK?liff=https://iton5.droppages.com/savinglc.html"
                  },
                  "height": "sm",
                  "style": "primary",
                  "margin": "md",
                  "color": "#9c88ff"
                },
                {
                  "type": "separator",
                  "margin": "md"
                },
                {
                  "type": "box",
                  "layout": "horizontal",
                  "margin": "md",
                  "contents": [
                    {
                      "type": "text",
                      "text": "พัฒนาโดย",
                      "size": "xs",
                      "color": "#aaaaaa",
                      "flex": 0
                    },
                    {
                      "type": "text",
                      "text": "iton5",
                      "color": "#aaaaaa",
                      "size": "xs",
                      "align": "end"
                    }
                  ]
                }
              ]
            },
            "styles": {
              "footer": {
                "separator": true
              }
            }
          }
        }]
        shareTargetPicker(msg)
      }




    }

    function removeTransaction(id) {
      Swal.fire({
        title: 'คุณแน่ใจแล้วใช่มั้ย?',
        text: "คุณกำลังจะทำการลบรายการนี้",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#9c88ff',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Confirm Delete'
      }).then((result) => {
        if (result.isConfirmed) {
          transactions = transactions.filter(transaction => transaction.id !== id);
          updateLocalStorage();
          Init();
          Swal.fire(
            'สำเร็จ!',
            'ดำเนินการลบเรียบร้อยแล้ว',
            'success'
          )
        }
      })

    }

    function updateLocalStorage() {
      localStorage.setItem('transactions', JSON.stringify(transactions));
    }


    function Init() {
      list.innerHTML = "";
      transactions.forEach(addTransactionDOM);
      updateValues();

    }

    Init();

    form.addEventListener('submit', addTransaction);

  </script>

</body>

</html>
