<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏ß‡∏î : ‡πÑ‡∏≠‡∏°‡∏≤‡∏™‡∏™‡∏≤‡∏à</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fce4ec;
        }
        h1, h2, h3 {
            color: #e91e63;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
      
.tip-button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
}

.tip-button:hover {
    background-color: #45a049;
}

.therapist-container {
    position: relative;
    width: 100%;
    overflow: hidden;
    padding: 20px 0;
}

.therapist-cards {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: 10px;
    position: relative;
}

.therapist-cards::-webkit-scrollbar {
    display: none;
}

.therapist-card img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 5px; /* ‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏•‡∏á */
    border: 3px solid #f48fb1;
    display: block;
    margin-left: auto;
    margin-right: auto;
}
      
.therapist-card {
    flex: 0 0 auto;
    width: 220px;
    margin-right: 20px;
    background-color: #fff;
    border-radius: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    padding: 15px;
    text-align: left; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô left alignment */
    justify-content: flex-start;
    min-height: 300px;
    max-height: 600px;
    overflow-y: auto;
}
  
.therapist-card h3 {
    margin: 2px 0; /* ‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡πà‡∏≤‡∏á */
    font-size: 20px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
    text-align: center; /* ‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
}

.therapist-card p {
    margin: 2px 0; /* ‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡πà‡∏≤‡∏á */
    font-size: 14px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
    padding: 5px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢ */
}

.therapist-card .working-hours {
    font-weight: bold; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ "‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:" ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ */
}

.therapist-card:last-child {
    margin-right: 0;
}

.booked-times {
    font-size: 14px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
    margin-top: 5px;
    padding: 5px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢ */
    text-align: left;
    flex-grow: 1;
    overflow-y: auto;
    max-height: 250px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î */
    background-color: #ffffff; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÜ */
    border-radius: 5px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô */
}
      
.booked-times h4 {
    margin-top: 0;
    margin-bottom: 10px;
    font-weight: bold;
}

.booked-slot {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #ffcdd2;
    padding: 5px;
    margin-bottom: 5px;
    border-radius: 5px;
}

.booked-slot-left {
    display: flex;
    align-items: center;
}

.user-profile-icon {
    width: 25px !important;
    height: 25px !important;
    border-radius: 50%;
    margin-right: 5px !important;
    border: 2px solid #ccc !important;
    object-fit: cover; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô */
}
        .therapist-card:last-child {
            margin-right: 0;
        }
        .therapist-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .therapist-card.selected {
            border: 3px solid #e91e63;
            background-color: #fce4ec;
        }
        
        .scroll-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(233, 30, 99, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .scroll-button:hover {
            background-color: rgba(233, 30, 99, 1);
        }
        .scroll-button.left {
            left: 10px;
        }
        .scroll-button.right {
            right: 10px;
        }
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        label, input, button {
            display: block;
            margin-bottom: 15px;
            width: 100%;
        }
        input, select {
            padding: 10px;
            border: 2px solid #f48fb1;
            border-radius: 5px;
            font-size: 16px;
        }
        .time-selection {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }
        .time-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .time-inputs {
            display: flex;
            justify-content: space-between;
        }
        .time-selection label {
            margin-bottom: 0;
            width: 45%;
        }
        .time-selection select {
            width: 45%;
        }
        button {
            background-color: #e91e63;
            color: white;
            border: none;
            padding: 12px;
            cursor: pointer;
            border-radius: 25px;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        button:hover {
            background-color: #c2185b;
            transform: scale(1.05);
        }
        #bookedSlots {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

              .time-inputs {
            display: flex;
            justify-content: space-between;
        }
        .time-inputs input[type="time"] {
            width: 45%;
        }
      
.status {
    padding: 4px 8px;
    border-radius: 3px;
    font-size: 0.9em;
    font-weight: bold;
}
        .status[data-status="‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞"] {
            background-color: #FFA500;
            color: black;
            cursor: pointer;
        }
        .status[data-status="‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à"] {
            background-color: #FFFF00;
            color: black;
        }
        .status[data-status="‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß"] {
            background-color: #027502;
            color: white;
        }

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
      
.payment-info {
    background-color: #fff;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    margin-top: 30px;
    margin-bottom: 30px;
}

.payment-info h2 {
    color: #e91e63;
    margin-bottom: 20px;
    font-size: 24px;
}

.bank-info {
    display: flex;
    align-items: stretch;
    background-color: #f8f8f8;
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 30px;
}

.bank-logo-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-right: 10px;
    padding-right: 10px;
    border-radius: 20%;
}

.bank-logo {
    width: 71px;
    height: 71px;
    object-fit: contain;
    border-radius: 20%;
    margin-top: 10px;
    margin-bottom: 5px;
}

.copy-button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background-color 0.3s, transform 0.3s;
    width: 100%;
    outline: none;  /* ‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î */
}

.copy-button:hover {
    background-color: #45a049;
}

.copy-button:active {
    transform: scale(0.98);  /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î */
}

.copy-button:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
}
.bank-details {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.bank-details p {
    margin: 5px 0;
    font-size: 16px;
}

.qr-code {
    text-align: center;
    background-color: #f8f8f8;
    border-radius: 15px;
    padding: 20px;
}

.qr-code h3 {
    margin-bottom: 15px;
    color: #333;
}

.qr-code-image {
    max-width: 200px;
    height: auto;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
    </style>
  
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        window.onload = function() {
            initializeLiff('2005939755-bWAP4K55');
          fetchBookedSlots().then(() => {
    updateTherapistCardBookings();
    updateBookedSlotsDisplay();
});
        }

function initializeLiff(myLiffId) {
    liff
        .init({
            liffId: myLiffId
        })
        .then(() => {
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                liff.getProfile().then(profile => {
                    window.userProfile = {
                        userId: profile.userId,
                        displayName: profile.displayName,
                        pictureUrl: profile.pictureUrl
                    };
                    console.log('User profile:', window.userProfile);
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                    fetchBookedSlots().then(() => {
                        updateTherapistCardBookings();
                        updateBookedSlotsDisplay();
                    });
                }).catch(err => console.error('Error getting profile:', err));
            }
        })
        .catch((err) => {
            console.error('LIFF Initialization failed', err);
        });
}
    </script>
  
</head>
<body>
    <h2>‚ú® ‡πÑ‡∏≠‡∏°‡∏≤‡∏™‡∏™‡∏≤‡∏à : iMassage ‚ú®</h2>
    <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≠‡∏ô‡∏ß‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
    <div class="therapist-container">
        <div id="therapistCards" class="therapist-cards"></div>
        <button id="scrollLeft" class="scroll-button left">&lt;</button>
        <button id="scrollRight" class="scroll-button right">&gt;</button>
    </div>
  
    <form id="bookingForm">
        <label for="date">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input type="date" id="date" required>

        <div class="time-selection">
            <div class="time-labels">
                <label for="startTime">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:</label>
                <label for="endTime">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</label>
            </div>
            <div class="time-inputs">
                <input type="time" id="startTime" required>
                <input type="time" id="endTime" required>
            </div>
        </div>

        <button type="submit">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏•‡∏¢! üéâ</button>
    </form>
  
<div id="paymentInfo" class="payment-info">
    <h2>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
    <p>‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏≥‡∏£‡∏∞‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ QR Code ‡∏Å‡πá‡πÑ‡∏î‡πâ</p>
    <div class="bank-info">
        <div class="bank-logo-container">
            <img src="https://lh3.googleusercontent.com/d/1X9zSCATLhN9H75hkL7E52VXAGHdI7wh4?key=123" alt="SCB Logo" class="bank-logo">
            <button onclick="copyToClipboard('accountNumber')" class="copy-button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
        </div>
        <div class="bank-details">
            <p><strong>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong> ‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå (SCB)</p>
            <p><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> <span id="accountNumber">4068460777</span></p>
            <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> ‡∏ô‡∏¥‡∏ï‡∏¥‡∏û‡∏• ‡∏®‡∏£‡∏µ‡∏Ñ‡∏¥‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå</p>
        </div>
    </div>
    <div class="qr-code">
        <h3>‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ QR Code</h3>
        <img src="https://promptpay.io/1461000136919.png" alt="QR Code" class="qr-code-image">
    </div>
</div>

    <script>
        const bookingForm = document.getElementById('bookingForm');
        const therapistCardsContainer = document.getElementById('therapistCards');
        const dateInput = document.getElementById('date');
        const startTimeSelect = document.getElementById('startTime');
        const endTimeSelect = document.getElementById('endTime');
        const bookedSlotsContainer = document.getElementById('bookedSlots');
        let selectedTherapistId = null;
        let therapists = [];
        let bookedSlots = [];

        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx1f6X_O9QR9ezT0jEueDbRG5Ekrw5wRvwImCxNOkNpeJYzqz1E365gRGCe9KTHMB4fYA/exec';

        const scrollAmount = 200;
        const scrollDuration = 300;

        document.getElementById('scrollLeft').addEventListener('click', () => {
            smoothScroll(document.getElementById('therapistCards'), -scrollAmount, scrollDuration);
        });

        document.getElementById('scrollRight').addEventListener('click', () => {
            smoothScroll(document.getElementById('therapistCards'), scrollAmount, scrollDuration);
        });

        function smoothScroll(element, amount, duration) {
            const start = element.scrollLeft;
            const startTime = performance.now();

            function animation(currentTime) {
                const timeElapsed = currentTime - startTime;
                const run = easeInOutQuad(timeElapsed, start, amount, duration);
                element.scrollLeft = run;
                if (timeElapsed < duration) requestAnimationFrame(animation);
            }

            function easeInOutQuad(t, b, c, d) {
                t /= d / 2;
                if (t < 1) return c / 2 * t * t + b;
                t--;
                return -c / 2 * (t * (t - 2) - 1) + b;
            }

            requestAnimationFrame(animation);
        }
      
        window.addEventListener('load', () => {
    fetchTherapists();
    setMinDate();
    fetchBookedSlots();
});

        function setMinDate() {
            const today = new Date();
            const dd = String(today.getDate()).padStart(2, '0');
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const yyyy = today.getFullYear();
            const minDate = yyyy + '-' + mm + '-' + dd;
            dateInput.min = minDate;
        }

        function fetchTherapists() {
            fetch(`${SCRIPT_URL}?action=getTherapists`)
                .then(response => response.json())
                .then(data => {
                    therapists = data.map(therapist => ({
                        ...therapist,
                        id: therapist.id.toString()
                    }));
                    generateTherapistCards();
                })
                .catch(error => console.error('Error:', error));
        }

function generateTherapistCards() {
    therapistCardsContainer.innerHTML = '';
    therapists.forEach(therapist => {
        const card = document.createElement('div');
        card.className = 'therapist-card';
        card.dataset.id = therapist.id;
        card.innerHTML = `
            <img src="${therapist.image}" alt="${therapist.name}">
            <h3>${therapist.name}</h3>
            <p><span class="working-hours">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</span> ${therapist.workingHours}</p>
            <div class="booked-times">
                <h4>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á:</h4>
            </div>
            <button class="tip-button" onclick="showTipPrompt('${therapist.id}')">‡πÉ‡∏´‡πâ‡∏ó‡∏¥‡∏õ</button>
        `;
        card.addEventListener('click', () => selectTherapist(therapist.id));
        therapistCardsContainer.appendChild(card);
    });
}


function closeTipForm() {
    document.getElementById('tipForm').remove();
}

function submitTip(therapistId) {
    const amount = document.getElementById('tipAmount').value;
    const fileInput = document.getElementById('tipSlip');
    if (amount && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const tipData = {
                action: 'addTip',
                therapistId: therapistId,
                therapistName: therapists.find(t => t.id === therapistId).name,
                amount: amount,
                slipImage: event.target.result
            };
            sendTipData(tipData);
        };
        reader.readAsDataURL(file);
    } else {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ');
    }
}
      
function showTipPrompt(therapistId) {
    event.stopPropagation();
    showTipForm(therapistId);
}
      
function selectTherapist(id) {
    document.querySelectorAll('.therapist-card').forEach(card => card.classList.remove('selected'));
    document.querySelector(`.therapist-card[data-id="${id}"]`).classList.add('selected');
    selectedTherapistId = id;
    updateBookedSlotsDisplay();
}

function isTimeBooked(startTime, endTime) {
    return bookedSlots.some(slot => 
        slot.therapistId === selectedTherapistId && 
        ((startTime >= slot.start && startTime < slot.end) ||
         (endTime > slot.start && endTime <= slot.end) ||
         (startTime <= slot.start && endTime >= slot.end))
    );
}

function fetchBookedSlots() {
    const date = dateInput.value;
    if (!date) {
        return Promise.resolve();
    }

    const formattedDate = new Date(date).toISOString().split('T')[0];

    showLoadingSpinner();
    return fetch(`${SCRIPT_URL}?action=getAllBookedSlots&date=${formattedDate}`)
        .then(response => response.json())
        .then(data => {
            hideLoadingSpinner();
            bookedSlots = data;
            updateTherapistCardBookings();
            updateBookedSlotsDisplay();
        })
        .catch(error => {
            hideLoadingSpinner();
            console.error('Error:', error);
        });
}
      
function updateTherapistCardBookings() {
    therapists.forEach(therapist => {
        const card = document.querySelector(`.therapist-card[data-id="${therapist.id}"]`);
        if (!card) return;
        const bookedTimesElement = card.querySelector('.booked-times');
        const therapistBookings = bookedSlots.filter(slot => slot.therapistId === therapist.id);
        
        bookedTimesElement.innerHTML = '<h4>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á:</h4>';
        
        if (therapistBookings.length === 0) {
            bookedTimesElement.innerHTML += '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>';
        } else {
            therapistBookings.forEach(slot => {
                const bookedSlot = document.createElement('div');
                bookedSlot.className = 'booked-slot';
                bookedSlot.innerHTML = `
                    <div class="booked-slot-left">
                        <img src="${slot.userProfileUrl}" alt="User Profile" class="user-profile-icon">
                        <span>${formatTime(slot.start)} - ${formatTime(slot.end)}</span>
                    </div>
                    <span class="status" data-status="${slot.paymentStatus}" data-user-id="${slot.userId}">${slot.paymentStatus}</span>
                `;
                if (slot.paymentStatus === '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞') {
                    bookedSlot.querySelector('.status').onclick = (e) => {
                        checkUserPermissionAndShowPaymentPrompt(e, slot);
                    };
                }
                bookedTimesElement.appendChild(bookedSlot);
            });
        }
    });
}

function updateBookedSlotsDisplay() {
    if (!bookedSlotsContainer) return;
    const date = dateInput.value;
    const therapist = therapists.find(t => t.id === selectedTherapistId);
    bookedSlotsContainer.innerHTML = `<h2>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß (${date})</h2>`;
    if (!therapist) {
        bookedSlotsContainer.innerHTML += '<p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≠‡∏ô‡∏ß‡∏î</p>';
        return;
    }
    const therapistBookings = bookedSlots.filter(slot => slot.therapistId === selectedTherapistId);
    if (therapistBookings.length === 0) {
        const noBookingMsg = document.createElement('div');
        noBookingMsg.textContent = `‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${therapist.name} ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date}`;
        bookedSlotsContainer.appendChild(noBookingMsg);
    } else {
        therapistBookings.forEach(slot => {
            const bookedSlot = document.createElement('div');
            bookedSlot.className = 'booked-slot';
            bookedSlot.textContent = `${formatTime(slot.start)} - ${formatTime(slot.end)}`;
            const statusSpan = document.createElement('span');
            statusSpan.className = `status ${slot.paymentStatus}`;
            statusSpan.textContent = slot.paymentStatus;
            if (slot.paymentStatus === '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞') {
                statusSpan.onclick = () => showPaymentPrompt(slot);
            }
            bookedSlot.appendChild(statusSpan);
            bookedSlotsContainer.appendChild(bookedSlot);
        });
    }
}

function showTipForm(therapistId) {
    const therapist = therapists.find(t => t.id === therapistId);
    const formHtml = `
        <div id="tipForm" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 1000; width: 300px;">
            <h3 style="margin-bottom: 15px;">‡πÉ‡∏´‡πâ‡∏ó‡∏¥‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${therapist.name}</h3>
            <input type="number" id="tipAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" style="width: calc(100% - 20px); margin-bottom: 15px; padding: 8px 10px;">
            <input type="file" id="tipSlip" accept="image/*" style="width: calc(100% - 20px); margin-bottom: 15px;">
            <div style="text-align: right;">
                <button onclick="submitTip('${therapistId}')" style="margin-right: 10px; padding: 8px 15px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button onclick="closeTipForm()" style="padding: 8px 15px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', formHtml);
}

function showPaymentForm(slot) {
    const formHtml = `
        <div id="paymentForm" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 1000; width: 300px;">
            <h3 style="margin-bottom: 15px;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <input type="number" id="paymentAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" style="width: calc(100% - 20px); margin-bottom: 15px; padding: 8px 10px;">
            <input type="file" id="paymentSlip" accept="image/*" style="width: calc(100% - 20px); margin-bottom: 15px;">
            <div style="text-align: right;">
                <button onclick="submitPayment('${slot.id}')" style="margin-right: 10px; padding: 8px 15px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button onclick="closePaymentForm()" style="padding: 8px 15px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', formHtml);
}

function closePaymentForm() {
    document.getElementById('paymentForm').remove();
}

function submitPayment(slotId) {
    const amount = document.getElementById('paymentAmount').value;
    const fileInput = document.getElementById('paymentSlip');
    if (amount && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const paymentData = {
                action: 'updatePayment',
                slotId: slotId,
                amount: amount,
                slipImage: event.target.result
            };
            sendPaymentData(paymentData);
        };
        reader.readAsDataURL(file);
    } else {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ');
    }
}
      
function showPaymentPrompt(slot) {
    const formHtml = `
        <div id="paymentForm" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 1000; width: 300px;">
            <h3 style="margin-bottom: 15px;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <input type="number" id="paymentAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" style="width: calc(100% - 20px); margin-bottom: 15px; padding: 8px 10px;">
            <input type="file" id="paymentSlip" accept="image/*" style="width: calc(100% - 20px); margin-bottom: 15px;">
            <div style="text-align: right;">
                <button onclick="submitPayment('${slot.id}')" style="margin-right: 10px; padding: 8px 15px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button onclick="closePaymentForm()" style="padding: 8px 15px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', formHtml);
}

function sendTipData(tipData) {
    tipData.userId = window.userProfile.userId;
    tipData.userProfileUrl = window.userProfile.pictureUrl;

    showLoadingSpinner();
    fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(tipData)
    })
    .then(response => response.json())
    .then(data => {
        hideLoadingSpinner();
        if (data.success) {
            alert(`‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏¥‡∏õ ${tipData.amount} ‡∏ö‡∏≤‡∏ó ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö ${tipData.therapistName}!`);
            closeTipForm();
            fetchBookedSlots();
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏¥‡∏õ: ' + data.message);
        }
    })
    .catch(error => {
        hideLoadingSpinner();
        console.error('Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏¥‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    });
}

function sendPaymentData(paymentData) {
    showLoadingSpinner();
    fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(paymentData)
    })
    .then(response => response.json())
    .then(data => {
        hideLoadingSpinner();
        if (data.success) {
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            closePaymentForm();

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô bookedSlots
            const updatedSlotIndex = bookedSlots.findIndex(slot => slot.id === paymentData.slotId);
            if (updatedSlotIndex !== -1) {
                bookedSlots[updatedSlotIndex].paymentStatus = '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à';
            }

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            updateTherapistCardBookings();
            updateBookedSlotsDisplay();
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ' + data.message);
        }
    })
    .catch(error => {
        hideLoadingSpinner();
        console.error('Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    });
}

        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            return `${hours}:${minutes}‡∏ô.`;
        }

dateInput.addEventListener('change', () => {
    fetchBookedSlots();
});

function bookAppointment(e) {
    e.preventDefault();
    if (!selectedTherapistId) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≠‡∏ô‡∏ß‡∏î');
        return;
    }
    const date = dateInput.value;
    const startTime = startTimeSelect.value;
    const endTime = endTimeSelect.value;

    if (!date || !startTime || !endTime) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
        return;
    }

    if (startTime >= endTime) {
        alert('‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô');
        return;
    }

    if (isTimeBooked(startTime, endTime)) {
        alert('‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô');
        return;
    }

    const therapist = therapists.find(t => t.id === selectedTherapistId);

    const bookingData = {
        action: 'bookAppointment',
        userId: window.userProfile.userId,
        userProfileUrl: window.userProfile.pictureUrl,
        therapist: therapist.name,
        therapistId: selectedTherapistId,
        date: date,
        startTime: startTime,
        endTime: endTime
    };

    showLoadingSpinner();
    fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(bookingData)
    })
    .then(response => response.json())
    .then(data => {
        hideLoadingSpinner();
        if (data.success) {
            alert(`‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ\n\n‡∏´‡∏°‡∏≠‡∏ô‡∏ß‡∏î: ${therapist.name}\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${date}\n‡πÄ‡∏ß‡∏•‡∏≤: ${startTime} - ${endTime}`);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô bookedSlots
            bookedSlots.push({
                id: data.bookingId, // ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å server
                therapistId: selectedTherapistId,
                start: startTime,
                end: endTime,
                paymentStatus: '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'
            });
            
            updateTherapistCardBookings();
            updateBookedSlotsDisplay();
            
            bookingForm.reset();
            document.querySelectorAll('.therapist-card').forEach(card => card.classList.remove('selected'));
            selectedTherapistId = null;
        } else {
            alert('‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + data.message);
        }
    })
    .catch(error => {
        hideLoadingSpinner();
        console.error('Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    });
}

bookingForm.addEventListener('submit', bookAppointment);
      
function checkUserPermissionAndShowPaymentPrompt(event, slot) {
    event.stopPropagation();
    const currentUserId = window.userProfile.userId;
    
    console.log(`Current user ID: ${currentUserId}`);
    console.log(`Slot user ID: ${slot.userId}`);

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (currentUserId === slot.userId) {
        console.log('User is the booker');
        showPaymentPrompt(slot);
        return;
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    fetch(`${SCRIPT_URL}?action=checkAdminPermission&userId=${encodeURIComponent(currentUserId)}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Admin check response:', data);
            if (data.isAdmin) {
                console.log('User is an admin');
                showPaymentPrompt(slot);
            } else {
                console.log('User is not authorized');
                alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: ' + error.message);
        });
}

function copyToClipboard(elementId) {
    const el = document.getElementById(elementId);
    const text = el.textContent;

    if (navigator.clipboard && window.isSecureContext) {
        // ‡πÉ‡∏ä‡πâ Clipboard API (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô HTTPS)
        navigator.clipboard.writeText(text).then(() => {
            showCopiedFeedback();
        }).catch(err => {
            console.error('Failed to copy: ', err);
            fallbackCopyTextToClipboard(text);
        });
    } else {
        // ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HTTP ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Clipboard API
        fallbackCopyTextToClipboard(text);
    }
}

function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
        document.execCommand('copy');
        showCopiedFeedback();
    } catch (err) {
        console.error('Fallback: Oops, unable to copy', err);
    }

    document.body.removeChild(textArea);
}

function showCopiedFeedback() {
    const button = document.querySelector('.copy-button');
    const originalText = button.textContent;
    button.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å";
    button.style.backgroundColor = "#2196F3";
    button.disabled = true;  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥

    setTimeout(() => {
        button.textContent = originalText;
        button.style.backgroundColor = "";
        button.disabled = false;
    }, 2000);
}
   
function showLoadingSpinner() {
    const spinnerHtml = `
        <div id="loadingSpinner" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 2000;">
            <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
                <div style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
                <p>‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', spinnerHtml);
}

function hideLoadingSpinner() {
    const spinner = document.getElementById('loadingSpinner');
    if (spinner) {
        spinner.remove();
    }
}

        fetchTherapists();
    </script>
</body>
</html>
